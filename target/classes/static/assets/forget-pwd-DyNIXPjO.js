import{d as B,R as I,r as p,u as P,a as $,o as S,E as m,b as N,c as D,_ as A,e as r,f as j,g as O,h as l,w as t,i as a,j as w,v as g,k as _,t as F}from"./app-sWctXk48.js";const K=B({compatConfig:{MODE:3},name:"Register",components:{ribbon:I},setup(){const e=p(""),o=p(""),E=p(""),C=p(""),y=p(""),b=p(0),f=p(!1),n=p(null),k=P();$();const d=()=>{k.push("/")},c=()=>{f.value=/^1[3-9]\d{9}$/.test(o.value)},h=async()=>{var i,s,v;try{if(!f.value){m.warning("请输入有效的11位手机号码");return}const{data:u}=await N.post("/api/sms-code",{mobile:o.value,templateCode:"SMS_285020683"},{timeout:3e3,headers:{"Content-Type":"application/json;charset=UTF-8"}});switch(u.code){case 200:M(),m.success({message:"验证码已发送至您的手机，5分钟内有效",duration:5e3,showClose:!0});break;case 429:m.warning("操作过于频繁，请60秒后再试"),M(60);break;case 500:m.error(`服务异常：${u.message||"请联系管理员"}`);break;default:D.alert(u.message||"短信服务暂不可用")}}catch(u){console.error("短信服务调用失败:",u);const L=new Map([["ECONNABORTED","请求超时，请检查网络连接"],["Network Error","网络连接不可用"],["ERR_BAD_REQUEST","无效的请求参数"],["403","AccessKey验证失败"]]),R=(i=u.response)==null?void 0:i.status,T=u.code||R,U=L.get(T)||((v=(s=u.response)==null?void 0:s.data)==null?void 0:v.message)||"服务暂时不可用，请稍后重试";m.error({message:`发送失败：${U}`,duration:3e3,showClose:!0})}},M=(i=60)=>{b.value=i,n.value&&clearInterval(n.value),n.value=setInterval(()=>{if(b.value<=0){clearInterval(n.value),n.value=null;return}b.value--},1e3)};return S(()=>{n.value&&clearInterval(n.value)}),{username:e,mobileNumber:o,smsCode:E,password:C,rpassword:y,countdown:b,isValidMobile:f,timer:n,goToLogin:d,validateMobile:c,sendCode:h,onSubmit:async()=>{var i,s;try{if(C.value!==y.value){m.error("两次输入的密码不一致");return}await N.post("/api/modifypasswd",{username:e.value,password:C.value,rpassword:y.value}),m.success("修改成功，请登录"),k.push("/")}catch(v){m.error(`修改失败: ${((s=(i=v.response)==null?void 0:i.data)==null?void 0:s.message)||v.message}`)}},t$:$().t}}}),Q={class:"common-layout"};function q(e,o,E,C,y,b){const f=r("el-image"),n=r("el-header"),k=r("el-divider"),d=r("el-form-item"),c=r("el-button"),h=r("el-form"),M=r("el-main"),V=r("el-footer"),i=r("el-container");return j(),O("div",Q,[l(i,null,{default:t(()=>[l(n,null,{default:t(()=>[l(f,{style:{width:"100%",height:"100%"},src:"/content/images/register_header.jpg",fit:e.fit},null,8,["fit"])]),_:1}),l(M,null,{default:t(()=>[l(h,{"label-position":e.labelPosition,"label-width":"auto",model:e.formLabelAlign},{default:t(()=>[o[8]||(o[8]=a("span",{class:"common-title"},"找回密码",-1)),l(k,{class:"thick-divider"}),l(d,{label:"用户账号","label-position":e.itemLabelPosition},{default:t(()=>[w(a("input",{"onUpdate:modelValue":o[0]||(o[0]=s=>e.username=s),placeholder:"请输入账号",style:{width:"550px"}},null,512),[[g,e.username]])]),_:1},8,["label-position"]),l(d,{label:"手机号码","label-position":e.itemLabelPosition},{default:t(()=>[w(a("input",{"onUpdate:modelValue":o[1]||(o[1]=s=>e.mobileNumber=s),onInput:o[2]||(o[2]=(...s)=>e.validateMobile&&e.validateMobile(...s)),placeholder:"请输入手机号码",style:{width:"550px"}},null,544),[[g,e.mobileNumber]])]),_:1},8,["label-position"]),l(d,{label:"短信验证码","label-position":e.itemLabelPosition},{default:t(()=>[w(a("input",{"onUpdate:modelValue":o[3]||(o[3]=s=>e.smsCode=s),placeholder:"请输入短信验证码",style:{width:"450px"}},null,512),[[g,e.smsCode]]),l(c,{type:"primary",disabled:!e.isValidMobile||e.isCounting,onClick:e.sendCode},{default:t(()=>[_(F(e.countdown>0?`${e.countdown}秒后重试`:"获取验证码"),1)]),_:1},8,["disabled","onClick"])]),_:1},8,["label-position"]),l(d,{label:"新密码","label-position":e.itemLabelPosition},{default:t(()=>[w(a("input",{"onUpdate:modelValue":o[4]||(o[4]=s=>e.password=s),type:"password",placeholder:"请输入密码",style:{width:"550px"}},null,512),[[g,e.password]])]),_:1},8,["label-position"]),l(d,{label:"确认新密码","label-position":e.itemLabelPosition},{default:t(()=>[w(a("input",{"onUpdate:modelValue":o[5]||(o[5]=s=>e.rpassword=s),type:"password",placeholder:"确认密码",style:{width:"550px"}},null,512),[[g,e.rpassword]])]),_:1},8,["label-position"]),l(d,null,{default:t(()=>[l(c,{type:"primary",onClick:e.onSubmit},{default:t(()=>o[6]||(o[6]=[_("修改密码")])),_:1},8,["onClick"]),l(c,{onClick:e.goToLogin},{default:t(()=>o[7]||(o[7]=[_("返回登录")])),_:1},8,["onClick"])]),_:1})]),_:1},8,["label-position","model"])]),_:1}),l(V,null,{default:t(()=>o[9]||(o[9]=[a("div",{id:"footer",class:"footer"},[a("p"),a("p"),a("p",null,"版权所有©2024-2025 深圳远方创新数据咨询有限公司"),a("p",null," 全国营销与客服热线：0755-27960108          技术支持：深圳远方创新数据咨询有限公司问题反馈或意见 ")],-1)])),_:1})]),_:1})])}const G=A(K,[["render",q],["__scopeId","data-v-e111d826"]]);export{G as default};
